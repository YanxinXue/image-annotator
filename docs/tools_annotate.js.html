<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: tools/annotate.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: tools/annotate.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>var SuperTool = require('../superTool');

/**
 * The annotation tool handles user input to the canvas. It allows
 * the user to draw out NEW annotations.
 * @param {Annotator} parent The Annotator the tool will operate on
 * @constructor
 * @extends {SuperTool}
 */
function AnnTool(parent) {
  SuperTool.call(this);
  this.parent = parent;

  /** @type {SuperShape} The annotation being drawn */
  this.ann = null;
}
AnnTool.prototype = Object.create(SuperTool.prototype);
AnnTool.fn = AnnTool.prototype;

/*jshint unused:vars*/

/**
 * Handles a left mouse up event, attempting to add a point to the annotation.
 * @param  {Number} x
 * @param  {Number} y
 * @memberOf AnnTool#
 * @method  lbUp
 */
AnnTool.fn.lbUp = function(x, y) {
  var a = this.parent;

  // Create annotation if we're not already making
  // one
  if (!this.active) {
    this.active = true;
    this.ann = a.annHelper.newAnn();
  }

  var pt = a.cHelper.ptToImg(x, y);

  this.active = this.ann.addPt(pt);
  a.showChange();
};

/**
 * Handler for left double-click, which immediately completes a Polygon annotation
 * @param  {Number} x
 * @param  {Number} y
 * @memberOf AnnTool#
 * @method lbDbl
 */
AnnTool.fn.lbDbl = function(x, y) {
  // NB: We get 2x 'up' events before the double-click
  // Need to remove erroneous extra points
  if (this.active) {
    var a = this.parent;
    this.active = false;

    this.ann.delPt(-1); // Remove pt from second click
    this.ann.delPt(-1); // Remove intermediate pt (would be next placed)

    a.showChange();
  }
};

/**
 * Handler for mouse movement, which updates the last added point
 * @param  {Number} x
 * @param  {Number} y
 * @memberOf AnnTool#
 * @method  mMove
 */
AnnTool.fn.mMove = function(x, y) {
  if (this.active) {
    var c = this.parent.cHelper;
    var pt = c.ptToImg(x, y);

    this.ann.modLastPt(pt);
    c.repaint();
  }
};

/**
 * Handler for keyboard input - delete key deletes the current annotation and ends drawing.
 * Backspace removes the last placed point, and deletes the annotation if it was the last point.
 * @param  {Number} key
 * @memberOf AnnTool#
 * @method keyDown
 */
AnnTool.fn.keyDown = function(key) {
  var anh = this.parent.annHelper;

  switch (key) {
    case 46: // Delete
      anh.getAnn().invalidate();
      this.active = false;
      this.parent.showChange();
      break;
    case 8: // Backspace
      if (this.active) {
        // Delete last placed point
        var pt = this.ann.getPts()[this.ann.getNumPts()-1];
        this.ann.delPt(-1);
        this.active = this.ann.isValid();

        if (this.active) {
          this.ann.modLastPt(pt);
        }

        this.parent.showChange();
      }
      break;
  }
};

/*jshint unused:true*/

module.exports = AnnTool;</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="AnnHelper.html">AnnHelper</a></li><li><a href="Annotator.html">Annotator</a></li><li><a href="AnnTool.html">AnnTool</a></li><li><a href="CanvasHelper.html">CanvasHelper</a></li><li><a href="EditTool.html">EditTool</a></li><li><a href="Feature.html">Feature</a></li><li><a href="PanTool.html">PanTool</a></li><li><a href="PointAnn.html">PointAnn</a></li><li><a href="PolyAnn.html">PolyAnn</a></li><li><a href="RectAnn.html">RectAnn</a></li><li><a href="SuperShape.html">SuperShape</a></li><li><a href="SuperTool.html">SuperTool</a></li></ul><h3>Global</h3><ul><li><a href="global.html#annotator">annotator</a></li><li><a href="global.html#createAnnotation">createAnnotation</a></li><li><a href="global.html#Initializer">Initializer</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.4.3</a> on Wed May 03 2017 13:48:13 GMT+0200 (Romance Daylight Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
